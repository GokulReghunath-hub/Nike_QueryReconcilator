with TOTAL_INV_AMNT AS (
SELECT SUM(INVOICE_AMOUNT) as TOTAL_INVOICE_AMOUNT,1 AS JOIN_FLAG FROM SF_POC.SF_MASKED_STAGE.NORMALISED_VENDOR_DATA_STAGE)

select NORMALIZED_ERP_VENDOR_NAME
,SPEND
,ROUND((SUM (SPEND) OVER  (ORDER BY SPEND DESC)/TOTAL_INVOICE_AMOUNT) * 100,2) AS CUM_PER
from (
SELECT NORMALIZED_ERP_VENDOR_NAME
,SUM(INVOICE_AMOUNT) as SPEND
from SF_POC.SF_MASKED_STAGE.NORMALISED_VENDOR_DATA_STAGE
group by 1
),TOTAL_INV_AMNT
WHERE 1 = TOTAL_INV_AMNT.JOIN_FLAG
ORDER BY SPEND DESC
